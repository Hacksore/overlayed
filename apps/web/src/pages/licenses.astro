---
import Layout from "../layouts/Layout.astro";
import Footer from "../components/footer.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import blogOgImage from "../assets/blog/overlayed-blog.png";
import fs from "node:fs/promises";

const url = new URL("../../licences.json", import.meta.url);
const json = await fs.readFile(url, "utf-8");
type License = {
  name: string;
  version: string;
  path: string;
  license: string;
  author: string;
  homepage: string;
  description: string;
};
type LicenseCollection = {
  [key: string]: Array<License>;
};

const data = JSON.parse(json) as LicenseCollection;
const content = Object.keys(data).map((key) => {
  return {
    license: key,
    element: data[key],
  };
});

// pnpm licenses --filter=desktop --prod list > licences.json
---

<Layout
  title="Overlayed - licenses"
  description="List of all dependencies and licenses used in the project."
  ogImage={blogOgImage.src}
>
  <main class="mx-auto px-8 pt-28">
    <h1>Overlayed Licenses</h1>
    {
      content.map((element) => (
        <div>
          <h2>{element.license}</h2>
          <ul>
            {element.element.map((license) => (
              <li>
                <h3>{license.name}</h3>
                <p>Version: {license.version}</p>
                <p>License: {license.license}</p>
                <p>Author: {license.author}</p>
                <p>
                  Homepage: <a href={license.homepage}>{license.homepage}</a>
                </p>
                <p>Description: {license.description}</p>
              </li>
            ))}
          </ul>
        </div>
      ))
    }
  </main>

  <Footer />
</Layout>
